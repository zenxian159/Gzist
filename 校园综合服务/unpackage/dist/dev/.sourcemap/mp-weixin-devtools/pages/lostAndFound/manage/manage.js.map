{"version":3,"names":["_toConsumableArray2","require","_objectSpread2","common_vendor","common_assets","utils_config","_sfc_main","__name","setup","__props","allItems","ref","filteredItems","activeFilter","openid","viewWidth","onLoad","info","index","getSystemInfoSync","value","windowWidth","user","getStorageSync","loadUserItems","showToast","title","icon","request","url","concat","config","baseURL","method","success","_ref","data","list","map","item","x","fail","filterItems","filter","i","type","showAllItems","showLostItems","showFoundItems","onMoveChange","e","currentTarget","dataset","detail","Math","min","max","onTouchEnd","event","editItem","id","find","navigateTo","encodeURIComponent","JSON","stringify","deleteItem","showModal","content","res","confirm","_ref2","setTimeout","splice","_ctx","_cache","a","b","o","c","d","f","g","i0","_a","_b","_c","_d","fileList","t","itemName","remarks","h","j","k","l","m","n","_imports_0$3","length","MiniProgramPage","_export_sfc","wx","createPage"],"sources":["pages/lostAndFound/manage/manage.js"],"sourcesContent":["\"use strict\";\nconst common_vendor = require(\"../../../common/vendor.js\");\nconst common_assets = require(\"../../../common/assets.js\");\nconst utils_config = require(\"../../../utils/config.js\");\nconst _sfc_main = {\n  __name: \"manage\",\n  setup(__props) {\n    const allItems = common_vendor.ref([]);\n    const filteredItems = common_vendor.ref([]);\n    const activeFilter = common_vendor.ref(\"all\");\n    const openid = common_vendor.ref(\"\");\n    const viewWidth = common_vendor.ref(0);\n    common_vendor.onLoad(() => {\n      const info = common_vendor.index.getSystemInfoSync();\n      viewWidth.value = info.windowWidth;\n      const user = common_vendor.index.getStorageSync(\"userInfo\") || {};\n      if (user.openid) {\n        openid.value = user.openid;\n        loadUserItems();\n      } else {\n        common_vendor.index.showToast({\n          title: \"请先登录\",\n          icon: \"none\"\n        });\n      }\n    });\n    function loadUserItems() {\n      common_vendor.index.request({\n        url: `${utils_config.config.baseURL}/posts?openid=${openid.value}`,\n        method: \"GET\",\n        success({\n          data\n        }) {\n          const list = data.map((item) => ({\n            ...item,\n            x: 0\n          }));\n          allItems.value = list;\n          filteredItems.value = [...list];\n        },\n        fail() {\n          common_vendor.index.showToast({\n            title: \"加载失败\",\n            icon: \"none\"\n          });\n        }\n      });\n    }\n    function filterItems() {\n      if (activeFilter.value === \"all\") {\n        filteredItems.value = [...allItems.value];\n      } else if (activeFilter.value === \"lost\") {\n        filteredItems.value = allItems.value.filter((i) => i.type === \"丢失物品\");\n      } else {\n        filteredItems.value = allItems.value.filter((i) => i.type === \"拾取物品\");\n      }\n    }\n    function showAllItems() {\n      activeFilter.value = \"all\";\n      filterItems();\n    }\n    function showLostItems() {\n      activeFilter.value = \"lost\";\n      filterItems();\n    }\n    function showFoundItems() {\n      activeFilter.value = \"found\";\n      filterItems();\n    }\n    function onMoveChange(e) {\n      const i = e.currentTarget.dataset.index;\n      const x = e.detail.x;\n      filteredItems.value[i].x = Math.min(0, Math.max(x, -100));\n    }\n    function onTouchEnd() {\n      const i = event.currentTarget.dataset.index;\n      const x = filteredItems.value[i].x;\n      filteredItems.value[i].x = x < -40 ? -100 : 0;\n    }\n    function editItem(id) {\n      const item = filteredItems.value.find((i) => i.id === id);\n      if (item) {\n        common_vendor.index.navigateTo({\n          url: `/pages/publish/publish?item=${encodeURIComponent(JSON.stringify(item))}`\n        });\n      }\n    }\n    function deleteItem(id, index) {\n      common_vendor.index.showModal({\n        title: \"确认删除\",\n        content: \"确定要删除这条信息吗？\",\n        success(res) {\n          if (res.confirm) {\n            common_vendor.index.request({\n              url: `${utils_config.config.baseURL}/deleteLostFound`,\n              method: \"POST\",\n              data: {\n                id\n              },\n              success({\n                data\n              }) {\n                if (data.success) {\n                  common_vendor.index.showToast({\n                    title: \"删除成功\",\n                    icon: \"success\"\n                  });\n                  filteredItems.value[index].x = 0;\n                  setTimeout(() => {\n                    filteredItems.value.splice(index, 1);\n                  }, 200);\n                } else {\n                  common_vendor.index.showToast({\n                    title: \"删除失败\",\n                    icon: \"none\"\n                  });\n                }\n              },\n              fail() {\n                common_vendor.index.showToast({\n                  title: \"删除失败\",\n                  icon: \"none\"\n                });\n              }\n            });\n          }\n        }\n      });\n    }\n    return (_ctx, _cache) => {\n      return common_vendor.e({\n        a: activeFilter.value === \"all\" ? 1 : \"\",\n        b: common_vendor.o(showAllItems),\n        c: activeFilter.value === \"lost\" ? 1 : \"\",\n        d: common_vendor.o(showLostItems),\n        e: activeFilter.value === \"found\" ? 1 : \"\",\n        f: common_vendor.o(showFoundItems),\n        g: common_vendor.f(filteredItems.value, (item, index, i0) => {\n          var _a, _b, _c, _d;\n          return common_vendor.e({\n            a: ((_a = item.fileList[0]) == null ? void 0 : _a.type) === \"image\"\n          }, ((_b = item.fileList[0]) == null ? void 0 : _b.type) === \"image\" ? {\n            b: item.fileList[0].url\n          } : ((_c = item.fileList[0]) == null ? void 0 : _c.type) === \"video\" ? {\n            d: item.fileList[0].url\n          } : {}, {\n            c: ((_d = item.fileList[0]) == null ? void 0 : _d.type) === \"video\",\n            e: common_vendor.t(item.itemName),\n            f: common_vendor.t(item.remarks),\n            g: common_vendor.t(item.type),\n            h: common_vendor.o(() => editItem(item.id), item.id),\n            i: common_vendor.o(() => deleteItem(item.id, index), item.id),\n            j: item.x,\n            k: index,\n            l: common_vendor.o(onMoveChange, item.id),\n            m: common_vendor.o(onTouchEnd, item.id),\n            n: item.id\n          });\n        }),\n        h: common_assets._imports_0$3,\n        i: viewWidth.value + \"px\",\n        j: viewWidth.value + \"px\",\n        k: filteredItems.value.length === 0\n      }, filteredItems.value.length === 0 ? {} : {});\n    };\n  }\n};\nconst MiniProgramPage = /* @__PURE__ */ common_vendor._export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-7577fd60\"]]);\nwx.createPage(MiniProgramPage);\n//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/lostAndFound/manage/manage.js.map\n"],"mappings":"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"}