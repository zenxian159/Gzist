{"version":3,"names":["common_vendor","require","utils_config","_sfc_main","__name","setup","__props","trades","ref","filteredTrades","activeTab","openid","onMounted","userInfo","index","getStorageSync","value","loadTrades","showToast","title","icon","request","url","concat","config","baseURL","method","success","res","__f__","data","Array","isArray","filterTrades","fail","err","filtered","filter","t","buyer_id","status","seller_id","showPurchasedOrders","showSoldOrders","updateTradeStatus","tradeId","cancelTrade","showModal","content","confirm","relistTrade","_ctx","_cache","e","a","o","$event","b","c","d","f","item","k0","i0","fileList","type","price","g","buyer_confirm","seller_confirm","h","i","trade_id","j","k","l","m","n","length","wx","createPage"],"sources":["pages/mall/orders/orders.js"],"sourcesContent":["\"use strict\";\nconst common_vendor = require(\"../../../common/vendor.js\");\nconst utils_config = require(\"../../../utils/config.js\");\nconst _sfc_main = {\n  __name: \"orders\",\n  setup(__props) {\n    const trades = common_vendor.ref([]);\n    const filteredTrades = common_vendor.ref([]);\n    const activeTab = common_vendor.ref(\"purchased\");\n    const openid = common_vendor.ref(\"\");\n    common_vendor.onMounted(() => {\n      const userInfo = common_vendor.index.getStorageSync(\"userInfo\");\n      if (userInfo && userInfo.openid) {\n        openid.value = userInfo.openid;\n        loadTrades();\n      } else {\n        common_vendor.index.showToast({\n          title: \"请先登录\",\n          icon: \"none\"\n        });\n      }\n    });\n    const loadTrades = () => {\n      common_vendor.index.request({\n        url: `${utils_config.config.baseURL}/trades`,\n        method: \"GET\",\n        success: (res) => {\n          common_vendor.index.__f__(\"log\", \"at pages/mall/orders/orders.vue:98\", res.data);\n          if (Array.isArray(res.data)) {\n            trades.value = res.data;\n            filterTrades();\n          } else {\n            common_vendor.index.__f__(\"error\", \"at pages/mall/orders/orders.vue:103\", \"❌ 非法数据:\", res.data);\n            trades.value = [];\n          }\n        },\n        fail: (err) => {\n          common_vendor.index.__f__(\"error\", \"at pages/mall/orders/orders.vue:108\", \"❌ 获取交易失败:\", err);\n          common_vendor.index.showToast({\n            title: \"加载失败\",\n            icon: \"none\"\n          });\n        }\n      });\n    };\n    const filterTrades = () => {\n      let filtered = [];\n      if (activeTab.value === \"purchased\") {\n        filtered = trades.value.filter(\n          (t) => t.buyer_id === openid.value && t.status !== \"可交易\"\n        );\n      } else if (activeTab.value === \"sold\") {\n        filtered = trades.value.filter(\n          (t) => t.seller_id === openid.value && t.status !== \"可交易\" && t.status !== \"已下架\"\n        );\n      }\n      common_vendor.index.__f__(\"log\", \"at pages/mall/orders/orders.vue:131\", filtered);\n      filteredTrades.value = filtered;\n    };\n    const showPurchasedOrders = () => {\n      activeTab.value = \"purchased\";\n      filterTrades();\n    };\n    const showSoldOrders = () => {\n      activeTab.value = \"sold\";\n      filterTrades();\n    };\n    const updateTradeStatus = (tradeId) => {\n      const userInfo = common_vendor.index.getStorageSync(\"userInfo\");\n      if (!userInfo || !userInfo.openid) {\n        common_vendor.index.showToast({\n          title: \"请先登录\",\n          icon: \"none\"\n        });\n        return;\n      }\n      common_vendor.index.request({\n        url: `${utils_config.config.baseURL}/trades/${tradeId}/confirm`,\n        method: \"PUT\",\n        data: { openid: userInfo.openid },\n        success: () => {\n          common_vendor.index.showToast({\n            title: \"操作成功\"\n          });\n          loadTrades();\n        },\n        fail: () => {\n          common_vendor.index.showToast({\n            title: \"确认失败\",\n            icon: \"none\"\n          });\n        }\n      });\n    };\n    const cancelTrade = (tradeId) => {\n      common_vendor.index.showModal({\n        title: \"确认取消订单\",\n        content: \"取消后订单无法恢复，确认取消吗？\",\n        success: (res) => {\n          if (res.confirm) {\n            common_vendor.index.request({\n              url: `${utils_config.config.baseURL}/trades/${tradeId}/status`,\n              method: \"PUT\",\n              data: {\n                status: \"已取消\"\n              },\n              success: () => {\n                common_vendor.index.showToast({\n                  title: \"已取消\"\n                });\n                loadTrades();\n              }\n            });\n          }\n        }\n      });\n    };\n    const relistTrade = (tradeId) => {\n      common_vendor.index.request({\n        url: `${utils_config.config.baseURL}/trades/${tradeId}/status`,\n        method: \"PUT\",\n        data: {\n          status: \"可交易\"\n        },\n        success: () => {\n          common_vendor.index.showToast({\n            title: \"已重新上架\"\n          });\n          loadTrades();\n        },\n        fail: () => {\n          common_vendor.index.showToast({\n            title: \"上架失败\",\n            icon: \"none\"\n          });\n        }\n      });\n    };\n    return (_ctx, _cache) => {\n      return common_vendor.e({\n        a: common_vendor.o(($event) => showPurchasedOrders()),\n        b: activeTab.value === \"purchased\" ? 1 : \"\",\n        c: common_vendor.o(($event) => showSoldOrders()),\n        d: activeTab.value === \"sold\" ? 1 : \"\",\n        e: common_vendor.f(filteredTrades.value, (item, k0, i0) => {\n          return common_vendor.e({\n            a: item.fileList[0].type === \"image\"\n          }, item.fileList[0].type === \"image\" ? {\n            b: item.fileList[0].url\n          } : item.fileList[0].type === \"video\" ? {\n            d: item.fileList[0].url\n          } : {}, {\n            c: item.fileList[0].type === \"video\",\n            e: common_vendor.t(item.title),\n            f: common_vendor.t(item.price),\n            g: common_vendor.t(item.status === \"交易完成\" ? \"交易完成\" : item.buyer_confirm && !item.seller_confirm ? \"待卖家确认\" : !item.buyer_confirm && item.seller_confirm ? \"待买家确认\" : item.status),\n            h: item.status === \"交易中\" && (!item.buyer_confirm || !item.seller_confirm)\n          }, item.status === \"交易中\" && (!item.buyer_confirm || !item.seller_confirm) ? {\n            i: common_vendor.o(($event) => updateTradeStatus(item.trade_id), item.trade_id)\n          } : {}, {\n            j: item.status === \"交易中\"\n          }, item.status === \"交易中\" ? {\n            k: common_vendor.o(($event) => cancelTrade(item.trade_id), item.trade_id)\n          } : {}, {\n            l: activeTab.value === \"sold\" && item.status === \"已取消\"\n          }, activeTab.value === \"sold\" && item.status === \"已取消\" ? {\n            m: common_vendor.o(($event) => relistTrade(item.trade_id), item.trade_id)\n          } : {}, {\n            n: item.trade_id\n          });\n        }),\n        f: filteredTrades.value.length === 0\n      }, filteredTrades.value.length === 0 ? {} : {});\n    };\n  }\n};\nwx.createPage(_sfc_main);\n//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/mall/orders/orders.js.map\n"],"mappings":"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"}